## 攻防演练场景梳理（以运营场景为主）

### 场景介绍和ISOP使用指导

#### 典型场景总览

![image-20200903094329585](E:\Typora\Image\image-20200903094329585.png)

#### 策略调优场景

##### 场景介绍

###### 场景描述

设备上线的时候，如果在客户环境中产生的事件数量比较多，需要做策略调优，排除一i邪恶误报，将事件的量降下来。

###### 策略调优思路

![image-20200903094625207](E:\Typora\Image\image-20200903094625207.png)

##### ISOP操作指导

###### ISOP对应功能及操作步骤：

Step1：快速发现需要调优的规则

​	对应功能：【全景态势】->【运维监控】->**【攻击行为监控】**快速发现告警数量特别多的事件

Step2：精细化规则调优

​	对应功能：【运维响应】->【运维工作台】->【事件运维】->【事件研判】使用**统计图功能、事件导出功能**细化白名单的粒度

Step3：执行调优

​	对应功能：**白名单配置**、企微规则误报反馈

![image-20200903095414176](E:\Typora\Image\image-20200903095414176.png)

![image-20200903095423992](E:\Typora\Image\image-20200903095423992.png)

###### 注意事项

事件统计图（数据透视）功能：

- 目前主要是支持源IP、目的IP、事件名称维度的统计，支持下钻。能够比较方便的满足一般的数据透视分析的需求

白名单功能：

- IP、端口、规则id都支持输入多个值，IP支持网段、通配符输入
- 白名单只控制数据能否被查询出来，不影响数据的存储。删除白名单后，之前命中白名单的数据又可以查询出来
- url暂不支持正则匹配、暂不支持备注和导出

规则误报反馈通道：

- 规则误报问题可以通过企微直接反馈，规则组会有专门的研发同事对接，反馈效率很高，可以不用走400

#### 事件运维场景

##### 场景描述

事件运维场景，主要是指事件的监控、研判、处置和上报，是攻防演练保障期间的重点工作

##### 事件运维思路

![image-20200903101251854](E:\Typora\Image\image-20200903101251854.png)

##### ISOP操作指导

![image-20200903101336939](E:\Typora\Image\image-20200903101336939.png)

##### 事件运维优先级

![image-20200903104325101](E:\Typora\Image\image-20200903104325101.png)

##### 失陷事件&高频事件

![image-20200903104903597](E:\Typora\Image\image-20200903104903597.png) 

##### 攻击研判

![image-20200903112505205](E:\Typora\Image\image-20200903112505205.png)

![image-20200903113128918](E:\Typora\Image\image-20200903113128918.png)

![image-20200903113209648](E:\Typora\Image\image-20200903113209648.png)

![image-20200903113311542](E:\Typora\Image\image-20200903113311542.png)

![image-20200903113352152](E:\Typora\Image\image-20200903113352152.png)

##### 封堵处置

![image-20200903113843816](E:\Typora\Image\image-20200903113843816.png)

##### 查询检索

![image-20200903114020455](E:\Typora\Image\image-20200903114020455.png)

![image-20200903114124802](E:\Typora\Image\image-20200903114124802.png) 

###### 注意事项

事件研判查询：

- 事件名称支持模糊查询、支持取反操作
- IP查询支持网段查询、支持取反
- 资产支持各种资产视图查询，支持取反
- 攻击载荷：支持关键字检索
- 攻击方向：可以过滤出和资产相关的事件（内到外、外到内、内到内）

智能检索：

- 内置查询：内置查询支持通配符查询
- 自定义查询：可以通过展开日志内容，来获取对应的字段名称。通过取反，例如查询所有命中情报的数据为：**!命中情报的字段:""**。自定义查询不支持通配符
- 数据统计透视：字段取值top5展示
- 自定义展示字段

##### ISOP操作

![image-20200903143537847](E:\Typora\Image\image-20200903143537847.png)

###### 注意事项

失陷事件：

- 目前的失陷事件主要是提取准确性较高的挖矿、勒索、木马、蠕虫、病毒等相关的规则（数量500+），误报率较低，有误报现象及时反馈
- 部分规则基于DNS流量进行检测，如果环境中有DNS服务器，建议将DNS服务器的转发流量加入白名单（DNS服务器IP+目的端口53）

uts配置：

- 记录弱口令明文密码，需要在uts将mask_passwd设置为否，如果客户环境中存在代理，需要开启use_cdn_set参数，可以直接将xff字段中的IP提取到攻击源IP

攻击者监控：

- 攻击上报不仅可以上报单个的事件，像这种有明显的持续的扫描行为的攻击，也需要及时上报，上报的攻击类型可以写成漏洞扫描

攻击成功的事件

- 当前攻击成功的判断规则误报比较多，在现场如果发现，走企微的规则误报反馈通道处理

攻击研判

- 研判数据优先级：流量上下文>载荷>告警，如果攻击流量被阻断，流量上下文中间可能没有响应报文信息，http攻击流量才有流量上下文信息，如果没有攻击载荷，查看告警日志中的信息

威胁狩猎

- 当分析发现一个高可疑的攻击者，甚至是实锤的攻击者，可以用威胁狩猎功能，查一下是否存在和攻击者同网段的IP，如果存在并且也存在攻击行为，可以当作攻击团伙进行上报

扩展调查

- 有些攻击无法通过单一的攻击判断是否成功，可以通过调查扩展，多观察一些攻击者其他的攻击行为以及资产遭受的其他攻击行为，可以为攻击结果判断提供一些帮助

持续监控

- 有些攻击不能立马判定是否成功，扩展调查中也没有啥线索，对于这种攻击者后续可以做持续监控，建议用自定义页签功能，持续监控高可疑攻击者的后续行为

封堵

- 支持基于事件视角和攻击者视角的自动封堵，但目前攻击者视角自动封堵只能配置白名单，不能配置细粒度的过滤条件

#### 情报同步和检测场景

在攻防演练期间，攻防演练相关的情报是非常重要且有效的，特别是针对攻击队相关的情报。在攻防演练期间，防守方指挥部会有专门收集情报的小分队，并把情报同步给各地的防守方

##### 情报同步和检测思路

![image-20200903151539354](E:\Typora\Image\image-20200903151539354.png)

##### 全流量场景-ISOP对应功能及操作步骤

![image-20200903151824119](E:\Typora\Image\image-20200903151824119.png)

![image-20200903151902478](E:\Typora\Image\image-20200903151902478.png)

![image-20200903151952530](E:\Typora\Image\image-20200903151952530.png)

![image-20200903151958379](E:\Typora\Image\image-20200903151958379.png)

##### 非全流量场景-ISOP操作指导

![image-20200903152107935](E:\Typora\Image\image-20200903152107935.png)

##### 注意事项

![image-20200903152128459](E:\Typora\Image\image-20200903152128459.png)

#### 应急响应场景

在攻防演练期间经常出现应急响应的情况，包括高危漏洞应急，以及客户靶机被打穿之后的应急等场景

##### 应急响应思路

![image-20200903152310179](E:\Typora\Image\image-20200903152310179.png)

##### ISOP操作步骤

![image-20200903152433862](E:\Typora\Image\image-20200903152433862.png)

#### 其他场景

![image-20200903152516956](E:\Typora\Image\image-20200903152516956.png)

#### 总结

![image-20200903152815712](E:\Typora\Image\image-20200903152815712.png)