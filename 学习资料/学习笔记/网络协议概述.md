# 网络协议概述

#### 网络协议基础

##### DDoS攻击简介

DDoS攻击：分布式拒绝服务攻击（DDoS：Distributed Denial of Service）攻击指借助于客户/服务器技术，将多个计算机联合起来作为攻击平台，对一个或多个目标发动DDoS攻击，从而成倍地提高拒绝服务攻击的威力

DDoS攻击趋势变化

- 2014年，50Gbps为主，攻击手法以IDC伪造源IP攻击为主
- 2015年，100Gbps+，攻击手法从伪造IP转向反射型Flood攻击
- 2016年，200Gbps+，loT和移动终端的兴起导致基于真实设备的攻击层出不穷
- 2017年，300Gbps+，基于私有协议和真实源的攻击事件呈指数级上升趋
- 2018年，新型Memcached反射放大型攻击爆发，打出1.7Tbps的超高流量

##### ARP攻击

ARP协议:通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的进行。

ARP攻击:就是通过伪造IlP地址和MAC地址实现ARP欺骗，能够在网络中产生大量的ARP通信量使网络阻塞，攻击者只要持续不断的发出伪造的ARP响应包就能更改目标主机ARP缓存中的IP-MAC条目，造成网络中断或中间人攻击。

![image-20200728094957705](E:\Typora\Image\image-20200728094957705.png)

攻击方式的演变

![image-20200728095026293](E:\Typora\Image\image-20200728095026293.png)

ARP攻击仅能在以太网（局域网如：机房、内网、公司网络等）进行，无法对外网（互联网、非本区域内的局域网）进行攻击

ARP攻击造成的影响：

- 断网
- 病毒传播
- 数据泄露

##### DNS劫持攻击

DNS劫持:又称域名劫持，是指在劫持的网络范围内拦截域名解析的请求，分析请求的域名，把审查范围以外的请求放行，否则返回假的IP地址或者什么都不做使请求失去响应，其效果就是对特定的网络不能访问或访问的是假网址

攻击方式：

1. 利用DNS服务器进行DDOS攻击
2. DNS缓存感染
3. DNS信息劫持
4. DNS重定向
5. ARP欺骗
6. 本机劫持

常见DNS劫持产生的环节和现象

![image-20200728095417987](E:\Typora\Image\image-20200728095417987.png)

DNS劫持造成的影响

- 网站无法访问
- 跳转到其他地址
- 钓鱼、诈骗
- 网站内出现恶意广告

#### 网络通讯协议

网络协议为计算机网络中进行数据交换而建立的规则、标准或约定的集合



##### 为什么需要网络通讯协议

在不同的计算机中，各机器使用的字符集千差万别，如果直接将信息转换为二进制,然后传输到其他电脑中，用户所看到的信息或许会因为字符集的不同而有巨大的差异。因此，数据传输时，必须要标准化，才能使信息正确地传达。标准化，便是网络协议说做的事。因此，在网络中传输数据时，必要网络协议。

##### 常见的网络通讯协议

- ###### TCP/IP

    - TCPIP是用于计算机通信的一组协议，我们通常称它为TCPIP协议族。它是70年代中期美国国防部为其ARPANET广域网开发的网络体系结构和协议标准，以它为基础组建的INTERNET是目前国际上规模最大的计算机网络，正因为INTERNET的广泛使用使得TCP/IP成了事实上的标准。

- ###### NetBEUI

    - NETBEUI是为IBM开发的非路由协议。缺乏路由和网络层寻址功能,既是其最大的优点，也是其最大的缺点。因此很快并很有效且适用于只有单个网络或整个环境都轿接起来的小工作组环境。

- ###### IPX/SPX

    - 是Novell公司的通信协议集。与NetBEUI形成鲜明区别的是IPX/SPX比较庞大，在复杂环境下具有很强的适应性。

##### 网络协议的组成及分层

网络协议组成的三要素：

- 语法：包括数据格式、数据编码以及信号等
- 语义：包括用于协调和差错处理的控制信息
- 定时：包括传输速率和数据排序等

网络协议分层

由于网络通讯的复杂性，在制定协议时，通常把复杂成分分解成一些简单成分，然后再将他们组装起来。各层协议之间既相互独立又相互高效的协调工作

层次结构基本要求：

（1）每一层都需要将自己的功能和对应的接口说明

（2）最高层必须为用户操作

（3）中间层必须为上下层提供服务

（4）把物理通信线路作为最低层，它能将从上层传来的信息用0101表示并传给其他终端

![image-20200728100755831](E:\Typora\Image\image-20200728100755831.png)



##### 网络分层模型

七层协议模型

![image-20200728100842482](E:\Typora\Image\image-20200728100842482.png)

###### 应用层：访问网络服务的接口，对应用程序的通信服务

- 例如：为操作系统或者网络应用程序提供访问网络服务的接口
- 常见：TELNET,HTTP,FTP,SNMP,DNS等

###### 表示层：提供数据格式转换服务

- 例如：解密与加密、图片解码和编码、数据的压缩和解压缩
- 实例：URL加密、口令加密、图片编解码等

###### 会话层：建立端连接并提供访问验证和会话管理（SESSION）

- 例如：使用校验点可使会话在通信失效时从校验点回复通信
- 示例：服务器验证用户登录、断电续传等

###### 传输层：提供应用进程之间的逻辑通信

- 例如：建立连接，处理数据包错误、数据包次序
- 常见：TCP、UDP、SPX、进程、端口（Socket）

###### 网络层：为数据在节点之间传输创建逻辑链路，并分组转发数据

- 例如：对子网间的数据包进行路由选择
- 常见：路由器、多层交换机、防火墙、IP、RIP、OSPF等

###### 数据链路层：在通信的实体之间建立数据链路连接

- 例如：将数据分帧，并吹流控制、物理地址寻址、重发等
- 常见：网卡、网桥、二层交换机等

###### 物理层：为数据端设备提供原始比特流的传输的通路

- 例如：网络通信的数据传输介质，由电缆与设备共同构成
- 常见：中继器、集线器、网线、HUB、RJ-45标准等

分层结构的优点

- 层间的标准接口方便了工程模块化。
- 创建了一个更好的互连环境。
- 降低了复杂度，使程序更容易修改，产品开发的速度更快。
- 每层利用紧邻的下层服务，更容易记住各层的功能。

数据的封装与分用

![image-20200728102038687](E:\Typora\Image\image-20200728102038687.png)

##### TCP/IP简介

定义:TCP/IP是一个网络通信模型，是整个网络传输协议家族，为互联网的基础通信架构。它常被通称为TCP/IP协议族，简称TCP/IP。

该协议族中两个核心协议:TCP(传输控制协议）和IP(网际协议)

基于TCP/IP协议的Internet已逐步发展成为当今世界上规模最大、拥有用户和资源最多的一个超大型计算机网络，TCP/IP协议也因此成为事实上的工业标准。

TCP/IP提供点对点的链接机制，将数据应该如何封装、定址、传输、路由以及在目的地如何接收都加以标准化。

###### TCP/IP协议栈

TCP/IP将软件通信过程抽象化为四个抽象层，采取协议堆栈的方式，分别实现不同通信协议。协议族下的各种协议，依其功能不同，被分别归属到四个层次结构之中，常被视为是简化的七层OSI模型

![image-20200728102512768](E:\Typora\Image\image-20200728102512768.png)

TCP/IP数据封装与解封

![image-20200728102648745](E:\Typora\Image\image-20200728102648745.png)

###### TCP/IP----应用层

应用层包含了不同类型的应用进程，如：telnet远程登陆、FTP文件传输等

![image-20200728111143006](E:\Typora\Image\image-20200728111143006.png)

###### 传输层

主要为两台主机上的应用程序提供端到端的通信服务。在TCP/IP协议族中，有两个不同的传输协议：TCP（传输控制协议）和UDP（用户数据报协议）

- 分割上层应用程序
- 建立主机应用程序间端到端的连接
- 将数据段从一台主机传到另一台主机
- 保证数据传送的可靠性

TCP和UDP采用16bit的端口号来识别不同的应用程序

网络服务一般都是通过知名端口号来识别的。例如，对于每个TCP/IP实现来说，FTP服务的TCP端口号都是21，每个Telnet服务的TCP端口号都是23。任何TCP/IP实现所提供的服务都使用知名的1~1023之间的端口号。这些知名端口号由Internet号码分配机构(Internet Assigned NumbersAuthority,IANA)来管理。

![image-20200728111551816](E:\Typora\Image\image-20200728111551816.png)

服务器一般通过知名端口号来识别应用程序，范围为1-1023

客户端口号，又称临时端口号，范围一般为1024-5000，大于5000的端口号为其他服务器预留

传输层TCP协议

- TCP首部的数据格式，如果不计任选字段，它通常是20个字节。
- 每个TCP段都包含源端和目的端的端口号，用于寻找发端和收端应用进程。这两个值加上IP首部中的源端IP地址和目的端IP地址唯一确定一个TCP连接。

![image-20200728111747125](E:\Typora\Image\image-20200728111747125.png)

TCP三次握手

![image-20200728111825362](E:\Typora\Image\image-20200728111825362.png)


TCP是面向连接的传输层协议，所谓面向连接就是在真正的数据传输开始前要完成连接建立的过程，否则不会进入真正的数据传输阶段。

- 为了建立或初始化一个连接，两个TCP通信者必须同步各自的初始序号。
- 初始序号是建立在一个TCP连接时的开始号，用与跟踪通信顺序并确保每个数据包传输时无丢失

传输层UDP协议

UDP是一个简单的面向数据报的传输层协议，UDP不提供可靠性，它把应用程序传给IP层的数据发送出去，但是并不保证它们能到达目的地。UDP和TCP在首部中都有覆盖它们首部和数据的检验和。UDP的检验和是可选的，而TCP的检验和是必需的

![image-20200728112037716](E:\Typora\Image\image-20200728112037716.png)

UDP特点

- 无序号及确认
- 不可靠、面向无连接
- 高效快速

TCP与UDP对比

![image-20200728112132788](E:\Typora\Image\image-20200728112132788.png)

###### 网络层

![image-20200728112412784](E:\Typora\Image\image-20200728112412784.png)

IP(网际协议）可以被认为是将数据包从一个主机
移动到另一个主机的传递机制。因为它处理传递，
它必须提供寻址功能。IP提供3种主要的功能:

- 无连接的，不可靠的传递服务
- 数据包分段和重组
- 路由功能

ICMP(lnternet互连网控制报文协议）是IP协议的附属协议，主要被用来与其他主机或路由器交换错误报文和其他重要信息。应用程序也可以访问它，例如我们常用的两个诊断工具ping和traceroute,都使用了ICMP协议。

ARP(地址解析协议）和RARP(反向地址解析协议）是某些网络接口(如以太网和令牌环网)使用的特殊协议，用来转换IP层和网络接口层使用的地址。



