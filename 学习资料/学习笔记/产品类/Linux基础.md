## Linux基础

什么是Linux

Linux是一台免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。他能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。

Linux操作系统诞生于1991年10月5日（这是第一次正式向外公布时间）。Linux存在着许多不同的Linux版本，但他们都使用了Linux内核。Linux可安装在各种计算机硬件设备中，比如手机、平板电脑、路由器、视频游戏控制台、台式计算机、大型机和超级计算机。

严格来讲，Linux这个词本身只表示Linux内核，但实际上人们已经习惯用Linux来形容整个基于Linux内核，并且使用GNU工程各种工具和数据库的操作系统。

window与Linux

Windows没有的：

- 稳定的系统
- 安全性和漏洞的快速修补
- 多用户
- 用户和用户组的规划
- 相对较少的系统资源占用
- 可定制裁剪，移植到嵌入式平台（如安卓设备）
- 可选择的多种图形用户界面（如GNOME，KDE）

Linux没有的

- 没有特定的支持厂商
- 游戏娱乐支持度不足
- 专业软件支持度不足

目录结构

![image-20200716092550187](E:\Typora\Image\image-20200716092550187.png)

/bin与/sbin

/bin，binary缩写，可执行的二进制文件，可被root与一般账户所使用

- 文件操作命令 ls、cd、cp
- 文本编辑命令 vi、ed
- 磁盘操作命令dd、df、mount

/sbin，s是super user缩写，超级用户才可以执行的二进制文件

- 磁盘检查修复命令fcsk
- 磁盘分区命令fdisk
- 关机命令shutdown
- 初始化系统命令init

/boot

启动Linux的一些核心文件以及开机所需配置文件等，非常重要，如遭到破坏系统无法启动

/dev

任何硬件与接口设备都是以文件的形态存在

- hd*IDE硬盘设备，hda是第一块，hdb是第二块

- sd*SCSI设备，sda代表是第一块，sdb代表第二块

- fd*软盘设备，fda代表第一个，fdb代表第二个

    *指数字

/etc

系统主要的配置文件

- 系统初始化文件rc
- 用户信息文件passwd
- 系统的环境变量配置profile
- IP地址与域名快速解析hosts
- 用户密码文件shadow
- DNS配置文件resolv.conf
- crontab系统级别守护进程配置文件

![image-20200716094509978](E:\Typora\Image\image-20200716094509978.png)

/home

- 用户文件的主目录，用户数据存放在此目录中
- Linux中每个用户都有自己的一个目录，目录名称一般与用户的账号名相同

/lib

- 共享程序库和映像文件
- 开机时会用到的函数库，以及在/bin或/sbin底下的指令会引用的函式库
- 每个程序不需分别保存自己的库文件，减少磁盘空间占用

/lost+found

- 保存丢失的文件，文件系统发生错误（如不恰当的关机操作与磁盘错误），，将一些遗失的片段放置到这个目录下
- 系统重启后引导程序运行fask来发现这些文件
- 除根目录/有此目录外，每个分区上均有一个lost+found目录

/root

- 超级用户root用户的目录，使用root登录后牧人进入此目录
- 一般用户没有进入此目录权限

/usr

- 应用程序和文件，系统安装时的软件包默认在此目录下
- /usr/lib、/usr/lib64 、/usr/local/lib、/usr/local/lib 64包含各应用软件的函式库、目标文件(object file)，以及不被一般使用者惯用的执行档或脚本(script),
- /usr/local本地安装的软件和其他文件，与linux无关
- /usr/bin与/usr/local/bin可执行的二进制文件
- /usr/include C语言的头文件，文件拓展名大多是.h

/var

- 系统运行以及软件运行日志
- /var/log重要，登录文件放置的目录，各种程序日志文件，里面比较重要的文件如/var/log/messages，/var/log/wtmp（记录登入者的信息）等

其他目录

- /media（centos7.*前版本）或者/run，可移除的装置，包括软盘、光盘、DVD等等装置都暂时挂载于此
- /tmp一般使用者或者是正在执行的程序存放临时文件，这些文件可能以及可以随时被删除
- /opt第三方软件放置的目录

账号分类

- 超级管理员：uid=0，绑定TCP1024以下端口
- 系统默认用户：系统程序使用，从不登录
- 新建普通用户：uid大于500（linux），/etc/passwd

passwd

/etc/passwd：对所有用户可读

![image-20200716102224506](E:\Typora\Image\image-20200716102224506.png)

shadow

/etc/shadow：

- 由于passwd文件所有用户可读，使用此文件保存
- 仅root用户具有读权限

![image-20200716102508907](E:\Typora\Image\image-20200716102508907.png)

用户组管理

groupadd：-g指定新建用户组的组id

newgrp：某个用户属于多个用户组，用于多个组间进行切换

groupdel：删除用户组，如包含用户则必须先删除用户

用户管理

useradd添加用户：

- -u  用户标识号
- -g  指定登录时默认组，不指定则自动创建与用户名相同的用户组
- -G  附加组
- -d  指定主目录
- -s  shell  新建用户默认使用的shell
- -c  说明信息

usermod修改用户账户信息

- -u  新的用户标识号
- -g  指定登录时新的默认组
- -G  修改附加组
- -d  修改主目录
- -s  shell  修改用户默认使用的shell
- -c  修改说明信息
- -l   新名称
- -L  锁定密码
- -U  解除密码锁定

userdel删除用户

- -r  不仅删除用户，还删除该用户的主目录以及目录下的所有文件

目录操作

绝对路径和相对路径

- 绝对路径：路径的写法【一定由根目录/写起】
- 相对路径：路径的写法【不是由/写起】相对路径意指【相对于目前工作目录的路径】

目录的基本操作

- pwd：显示当前的工作目录
- mkdir：创建一个新的目录
- rmdir：删除一个空的目录
- ls：显示指定目录下的内容

变换目录：

- cd或者cd~ 返回当前用户默认工作所在目录
- cd~[用户名] 返回指定用户的工作目录（~与用户名间无空格）
- cd .. 或者cd ../返回上级目录
- cd /返回到根目录

文件操作

more 分屏显示文本文件

- more -c -10 1.txt  显示1.txt内容，每10行显示一屏并清除屏幕

cat输出文件内容，类似于dos下的type，还可以合并文件

- cat 文件1 文件2 > 文件3   将文件1与文件2内容合并后输出到文件3

grep文本过滤工具

- grep ns tset.txt  列出test.txt文件中含有ns字符串的行

rm删除某个目录或某个目录下的所有文件以及子目录

- -r  递归删除
- -f  忽略不存在的问题，也不提示
- -i  删除前确认
- **慎重使用rm -rf**

cp复制文件或者目录到另一个文件或者目录中

mv移动文件或者目录，同目录下表示重命名

find在指定的路径下查找指定的文件

- -name  ‘字符串’查找文件名匹配的字符串
- -type   文件类型  按照指定文件类型查找（f为普通文件，d为目录等）
- -perm  根据文件的权限来查找文件
    - find -perm mode
    - find -perm -mode
    - find -perm +mode
- find /root/-name install.log 在/root目录下查找名称是install.log的文件

磁盘操作

df检查Linux的系统磁盘空间占用

- -k 以kb为单位输出占用情况
- -m  以MB为单位输出占用情况
- -T  显示磁盘分区的文件系统类型
- -h  以容易理解的格式输出占用情况，如32KB,120MB,60GB

du显示文件或目录占用的磁盘空间情况

- -s  显示文件或者整个目录大小，单位为KB
- -sh  以人性化的格式显示文件或者目录大小，如300MB，1.2G
- -sm  以MB为单位显示文件或者目录大小

date显示或修改系统时间

- date显示当前时间
- date -s "2018-7-13 20:00:00"
- date -s 20180713
- data -s 20:00:00

passwd设置用户密码

- passwd根据提示修改自己的密码
- passwd zhangsan其他用户修改zhangsan的密码

su改变用户身份

- su - 普通用户转变为root（不加-也可以，但是不回家再root环境变量，因此某些指令可能无法执行导致提示command not found）
- su zhangsan 切换为zhangsan用户身份

man显示指定命令的帮助信息

- man touch显示touch命令的帮助信息

clear清除屏幕信息

who显示目前登录到系统的用户

###### uname显示操作系统相关信息

- -a 显示操作系统全部信息
- -m显示操作系统是32位还是64位
- -n显示操作系统主机名
- -s显示操作系统类型
- -r 显示操作系统内核版本

###### uptime输出系统任务队列信息

- 现在时刻
- 运行多长时间
- 多少用户在线
- 1分钟5分钟15分钟前到现在的平均负载

###### free显示内存状态

- -m以MB为单位显示内存使用情况
- -K以KB为单位
- -b 以字节为单位

###### ps显示系统进程瞬间的运行状态

- ps -aux显示USER，PID，%CPU，%MEM,,VSZ(虚拟内存)，RSS(内存)，TTY，STAT(状态)，START(开始时间)，TiME(执行时间)，COMMAND
- ps -ef显示UID，PID(进程ID)，PPID(父进程ID) ,C(CPU占用)，STIME(开始时间），TTY，TIME(运行时间)，CMD

ps与grep连用：ps -ef | grep ssh

与kill连用杀掉进程：kill -9 (pid进程号)

###### top显示cpu内存等信息，类似于Windows的资源管理器

- 统计信息区--任务队列（第一行）
    - 当前系统时间
    - 系统运行时间
    - 当前登录系统用户数
    - 系统平均负载（1分钟5分钟15分钟前到现在的平均负载）

- 统计信息区--进程信息（第二行）
    - 进程总数
    - 正在运行进程数
    - 处于休眠的进程数
    - 停止的进程数
    - 僵死的进程数
- 统计信息区--CPU信息（第三行）
    - 用户进程占用CPU百分比
    - 系统进程占用CPU百分比
    - 用户进程内改变过优先级的进程占用CPU百分比
    - 系统进程占用CPU百分比
    - 空闲CPU占用百分比
    - 等待输入输出的进程占用CPU百分比
- 统计信息区--内存信息（最后两行）
    - 物理内存大小
    - 已使用物理内存大小
    - 空余内存大小
    - 内核缓冲区内存大小
    - 交换分区内存大小
    - 已使用的交换分区大小
    - 空闲的交换分区大小
    - 缓存大小
- 进行信息区
    - 进程id
    - 进程所有者用户名
    - 进程优先级
    - nice值，负值优先级高，正值优先级低
    - 进程使用的虚拟内存总量，KB
    - 进程使用的未被换出的物理内存，KB
    - 共享内存大小
    - 进程状态
        - D不可终端的睡眠，R运行，S睡眠
        - T跟踪/停止，Z僵死
    - 上次更新到现在的CPU时间占用百分比
    - 进程占用的物理内存百分比
    - 进程总计使用的CPU时间，单位0.01
    - 正在运行进程的命令或者命令路径
- h或者?  显示帮助信息
- m切换内存信息
- t切换显示进程和CPU状态信息
- q退出top显示
- c切换完整的命令行和命令名称信息
- M根据内存大小排序
- P根据CPU使用百分比大小进行排序
- T根据时间/累计时间进行排序

pstree以树状图的方式展现进程之间的派生关系，显示效果比较直观

# vi

- 文本编辑程序，vi filename
- 一般模式
    - vi处理文件时已进入该文件，就是一般模式，可以进行删除，复制，粘贴等操作
- 文编编辑模式
    - 一般模式下按下‘i，I，o，O，a，A，r，R’等字母之后才能进入编辑模式，左下方会出现INSERT或者REPLACE字样，才可以输入任何文字到文件中
- 文本编辑模式下编辑文件
    - 在一般模式中，输入“：或者/或者？”即可将光标移动到最下面一行，在该模式下，您可以搜索数据，而且读取，保存，大量删除字符，离开vi，显示行号等操作
- 屏幕翻滚命令
    - ctrl+u 向文件首翻半屏
    - Ctrl+d向文件尾翻半屏
    - Ctrl+f向文件尾翻一屏
    - Ctrl+b向文件首翻一屏
- 保存与退出，命令模式下
    - :wq保存并退出vi
    - :W保存但不退出vi
    - :w!强制保存
    - :w filename将修改保存到一个文件，即另存为
    - :q不保存就退出vi
    - :q!或者:wq!不保存并强制退出vi
- 插入与删除，文本编辑模式
    - Esc从编辑模式切换到命令模式
    - a在当前光标后添加文本
    - A在行末添加文本
    - i在当前光标前插入文本
    - l在行首插入文本
    - o在当前行后面插入一空行
    - O在当前行前面插入一空行
    - x或X删除一个字符，x删除光标后的，而X删除光标前的
    - D删除从当前光标到光标所在行尾的全部字符
    - dd删除光标行正行内容
    - ndd删除当前行及其后n-1行
    - nyy将当前行及其下n行的内容保存到剪切板，其中n为一个数字
    - p粘贴文本操作，用于将剪切板的内容粘贴到当前光标所在位置的下方
    - Р粘贴文本操作，用于将剪切板的内容粘贴到当前光标所在位置的上方
    - yw将光标所在的单词复制到剪切板

- 搜索和替换
    - /abc在文件中向前查找字符串abc，查找的字符串会被加亮显示
    - ?abc在文件中向后查找字符串abc，意找的字符串会被加亮显示
    - n在同一方向重复上次的搜索命令
    - N在相反方向重复上次的搜索命令
    - :g/a1/a2/g将文件中所有的a1替换为a2
    - :n1,n2s/a1/a2/g将文件中n1至n2行所有a1替换为a2
    - :set number在命令模式下，用于在最左端显示行号;
    - :set nonumber在命令模式下，用于在最左端不显示行号;
- 光标移动
    - :行号光标跳转到指定行的行首;
    - :$光标跳转到最后一行的行首;
    - h或向左箭头键(←)光标向左移动一个字符
    - j或向下箭头键(↓)光标向下移动一个字符
    - k或向上箭头键(↑)光标向上移动一个字符
    - l或向右箭头键(→)光标向右移动一个字符
    - [Ctrl]+[f]屏幕『向下』移动一页，相当于[Page Down]按键(常用)
    - [Ctrl] +[b]屏幕『向上』移动一页，相当于[Page Up]按键(常用)
    - [Ctrl]+[d]屏幕『向下』移动半页
    - [Ctrl] +[u]屏幕『向上』移动半页
    - ＋光标移动到非空格符的下一行
    - -光标移动到非空格符的上一行
    - H光标移动到这个屏幕的最上方那一行的第一个字符
    - M光标移动到这个屏幕的中央那一行的第一个字符
    - L光标移动到这个屏幕的最下方那一行的第一个字符
    - G移动到这个档案的最后一行(常用)
    - nG  n为数字。移动到这个档案的第n行(可配合:set nu)
    - gg 移动到这个文档的第一行
    - n<Enter>  n为数字。光标向下移动n行(常用)
    - n<space>那个n表示『数字』，按下数字后再按空格键，光标会向右移动这一行的n个字符
    - 0或功能键[Home] 这是数字『0』∶移动到这一行的最前面字符处(常用)
    - $或功能键[End]移动到这一行的最后面字符处(常用) 

### 网络命令

ifconfig配置网络或显示当前网络接口状态(windows下
ipconfig)

- ifconfia eth0 up激活eth0口
- ifconfig eth0 down 禁用eth0口
-  ifconfig eth0 1.1.1.1 netmask255.255.255.0
- 网卡重启或系统重启后上述配置失效，如永久生效需要修改配置文件

网络配置文件

- /etc/sysconfig/network-scripts/ifcfg-interfancename

DNS配置文件

- /etc/resolv.conf

主机与IP绑定文件hosts

- /etc/hosts

主机名与网关配置文件

- /etc/sysconfig/network，网络配置是否正常运行，主机名，网关
- 永久修改主机名就是修改配置文件后重启系统生效
- 临时修改则是hostname，重启后失效

配置网卡

- 修改/etc/sysconfig/network-scripts/ifcfg-eth0文件(CentOS6)
- CentOS6中网卡名称为eth0，eth1
- CentOS7中网卡名称为enp0s1,enpOs2

重启网络服务

- service network restart

netstat 显示本机网络接口、运行端口与路由表

- -a显示本机所有连接和监听端口
- -n以网络ip地址的形式显示当前建立的连接和端口
- -r显示路由表
- -p连接对应的PID与程序名
- 可以结合grep使用，如netstat -ano | grep 80

traceroute追踪路由，windows下的tracert

telnet探测端口

wget 下载

## IPtables

netfilter/iptables(简称为iptables)组成Linux平台下的包讨滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，它可以代替昂贵的商业防火墙解决方案，完成封包过滤、封包重定向和网络地址转换(NAT)等功能。

规则（rules）其实就是网络管理员预定义的条件，规则一般的定义为“如果数据包头符合这样的条件，就这样处理这个数据包”。规则存储在内核空间的信息包过滤表中，这些规则分别制定了源地址、目的地址、传输协议（如TCP、UDP、ICMP）和服务类型（如HTTP、FTP和SMTP）等。当数据包与规则匹配时，iptables就根据规则所定义的方法来处理这些数据包，如放行（accept）、拒绝（reject）和丢弃（drop）等。配置防火墙的主要工作就是添加、修改和删除这些规则。

service iptables status//查看iptables状态
iptables -L-n//查看iptables配置
service iptables restart/重启iptables
service iptables stop/!停止iptables
iptables-L/查看开放端口
iptables -F//请掉现在iptabls的连接
chkconfig iptables on/chkconfig iptables off//开机启动

命令行添加

![image-20200716154901287](E:\Typora\Image\image-20200716154901287.png)

![image-20200716155301310](E:\Typora\Image\image-20200716155301310.png)

![image-20200716155322028](E:\Typora\Image\image-20200716155322028.png)

查看CPU信息：more/proc/cpuinfo

查看内存信息：more/proc/meminfo

查看磁盘分区信息：fdisk -l

硬件文件：

![image-20200716155806169](E:\Typora\Image\image-20200716155806169.png)

挂载与卸载

mount -t 文件系统类型 设备名 挂载目录(挂载到哪里)

![image-20200716155952890](E:\Typora\Image\image-20200716155952890.png)

umount 挂载目录

优盘挂载与卸载

![image-20200716160048914](E:\Typora\Image\image-20200716160048914.png)

Linux常见服务搭建

SMB服务搭建

FTP服务搭建

DNS服务搭建