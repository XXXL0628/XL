# RSAS

NSFOCUS Remote Security Assessment System

绿盟科技远程安全评估系统

#### 产品简介

什么是漏洞扫描系统

- 基于漏洞数据库，通过扫描等手段，对指定的计算机系统的安全脆弱性进行检测，发现可利用的漏洞的一种安全检测行为

高效、准确发现系统安全漏洞

- 资产风险管理
- 漏洞管理
- 漏洞解决方案
- 专注于系统级安全漏洞
    - 基础架构：操作系统、数据库、中间件、通信协议
    - 应用系统：应用软件、应用系统、虚拟化系统
    - 硬件设备：网络设备、安全设备、办公自动化产品

#### 部署模式

##### 独立部署

- 网络较为集中
- 分权管理和使用
- 部署一台绿盟远程安全评估系统设备

![image-20200716162525304](E:\Typora\Image\image-20200716162525304.png)

##### 多级分布式部署

- 多级网络结构
- 数据汇总、集中管理
    1. 与ESPC联动（RSAS最新版与ESPC 6.1.5.1及以上版本）
    2. 与平台（ESP、TVM）联动

![image-20200716162708097](E:\Typora\Image\image-20200716162708097.png)

设备型号设备

RSAS NX3-P

RSAS NX3-X

RSAS NX3-S

RSAS NX3-E

RSAS NX3-VM（虚拟化设备，用光盘装在客户提供的设备上）

主要区别在于外观上网口数量不同、电源接口数量不同（1U/2U）

虽然型号不同，但只要版本相同，软件功能和使用方法完全一样

接口介绍

![image-20200716165311372](E:\Typora\Image\image-20200716165311372.png)

设备开关介绍

如何重启?
·在界面系统管理-状态-重启系统
·串口登陆-重启系统
·短触开关键（点触式开关)
如何关机?
·在界面上系统管理-状态-关闭系统
·串口登陆-关闭系统
直接拔电源会怎么样?
·设备中有硬盘，可能会导致硬盘故障

#### 扫描原理介绍

任务生成，调度

![image-20200716165717624](E:\Typora\Image\image-20200716165717624.png)

存活判断

扫描器的存活判断扫描手段有：

- ICMP ping扫描（ping）
- TCP ping 端口（TCP SYN）
- UDP ping 端口

TCP SYN判断：

- 存活且端口开放：收到SYN+ACK包
- 存活但端口不开放或被防火墙过滤：收到RST包
- 不存活或被防火墙DROP：直到超时都没有收到回应包

TCP connect扫描

![image-20200717100756383](E:\Typora\Image\image-20200717100756383.png)

端口扫描：TCPconnect、TCP syn、UDP

使用nmap -sT ip -p port扫描会在目标系统留下log记录，但是稳定可靠，可抓取banner信息

TCP SYN扫描

![image-20200717102656269](E:\Typora\Image\image-20200717102656269.png)

nmap -sS IP -p 端口

特点：

- 不会在目标系统留下log记录
- 若大量使用半连接，可能会被IDS等系统判定为拒绝服务攻击而被记录，也可能因此导致误漏判

UDP端口扫描

![image-20200717102910807](E:\Typora\Image\image-20200717102910807.png)

nmap -sU -p 端口 IP

特点：

- 等待超时做判断，时间很长
- UDP基于无连接，加上有些系统不会返回icmp_port_unreachable包，结果可能不可靠

系统服务识别

主动指纹识别（即主动发包探测系统、服务标识）

指纹（banner）：系统、服务的自己的、唯一的特征标志

作为网络操作系统,系统的指纹实际上来源于TCPIIP协议栈。TCP/IP协议栈技术只是在RFC文档中描述,并没有一个统一的行业标准,各个公司在编写应用于自己的操作系统的TCP/IP协议栈时对RFC文档做出了不尽相同的诠释,造成了各个操作系统在TCP/IP协议的实现上有所不同。

标准端口常见服务

- FTP  21
- SSH 22
- Telnet  23
- SMTP  25
- DNS  53
- HTTP  80
- POP3  110
- HTTPS  443

端口要是客户有需求要修改，可以自定义

#### 登陆方式

##### 串口登录（conadmin/conadmin）

扫描器的波特率都是选择115200

客户常见的需要登录串口的场景：

1、忘记密码：重置web界面admin的密码

2、查看网络配置：查看管理口的IP

3、重装系统：只能在串口下进行，重装后系统会还原成出厂版本，除网络配置及ip授权使用情况及证书外其他数据均会清空

##### web界面登录（最常用的登陆方式）

笔记本直连管理口，且笔记本的ip与管理口ip属于同一子网，在浏览器输入https://192.168.1.1按回车

导入证书后，输入默认用户名密码（admin/admin）

##### Ssh后台登陆（支持代表、研发测试有权限登录）

#### 扫描任务下发和相关功能介绍

##### 配置扫描口

##### 配置路由

- 界面上显示的只有工作口的地址，没有管理口的地址，管理口只能在串口下配置

##### 新建任务

![image-20200717105814335](E:\Typora\Image\image-20200717105814335.png)

远程漏洞扫描和本地漏洞扫描的最大区别在于获取的目标主机的权限不同，本地漏洞扫描获取的权限高于远程漏洞扫描

本地扫描实现的方式：

- 勾选登陆检查
- 勾选口令猜测任务，并猜测出
    - 口令猜测为暴力猜测可能影响客户业务，需提前征求客户的意见

口令猜测

先猜用户自定义密码字典，然后才系统默认密码字典，默认猜测SMB、TELNET、SSH三种协议

使用smb协议登录扫描时，要满足以下3个条件：

1. 共享系统盘，一般是c盘
2. server服务必须打开
3. ”网络访问：本地账户的共享和安全模式“改为”经典-对本地用户进行身份验证，不改变其本来身份“

自动发送报表

报表类型：html、word、excel、pdf、xml

仅支持html格式报表到管理员邮箱，需要配置邮件服务器

#### 常见问题处理

##### 系统升级问题

升级设置

手动升级

- 证书是否过期
- 检查MD5值是否正确
- 更换浏览器试试

自动升级

- 使用常用工具中的ping，能否ping通”update.nsfocus.com“
- 若不能，请正确配置ip和DNS

升级线路

![image-20200717113316608](E:\Typora\Image\image-20200717113316608.png)

升级注意：

- 有的升级包较大，升级时间会很长，希望耐心等待，不要重启设备
- 定制包升级策略：打了定制包的客户需要查看当时的定制包说明文档，看是否允许进行升级

##### DNS配置

当配自动升级提示检测不到站点或不成功的时候就要检查一下，还有去做web扫描的时候，扫不成功的时候检查一下配置

##### 授权问题

清空已使用IP方法：

1. 试用证书切换成正式证书，授权会被清空
2. 正式证书过期，用户续证，正式证书起始时间发生变化，清空授权
3. 申请清空包

注：任何时候导入试用证书都不清空授权

域名和IP只会占用一个授权

##### 证书权限

![image-20200717140910082](E:\Typora\Image\image-20200717140910082.png)

##### 获取接口MAC的方法

1. 串口登录，系统状态-网卡
2. 笔记本直连设备接口，并将笔记本网卡和接口配置成同网段，然后在笔记本上ping接口IP，然后再在笔记本上arp -a查看接口IP对应的MAC

##### 若扫描器与扫描目标之间存在防火墙等网络设备

![image-20200717141404968](E:\Typora\Image\image-20200717141404968.png)

##### 误报分析

###### 版本扫描误报分析

1. 检查RSAS设备的系统版本和插件版本是不是最新（可以查看主机报表，获取RSAS的系统版本与系统插件版本。PS：若RSAS的系统与插件不是最新版本建议升级到最新再进行扫描）

2. 检查是否是登陆扫描

    ​	与客户确认：是否进行登陆扫描任务（推荐）

    ​	查看主机报表：

    ​		Windows系统：139端口的漏洞，有如下图特征漏洞即为登陆扫描

    ​		Linux系统：22端口的漏洞，点开主机报表中漏洞右面的符号，显示vulid为6位数

    ​	查看任务参数：是否为登陆扫描任务

    ![image-20200717142834627](E:\Typora\Image\image-20200717142834627.png)

    ![image-20200717142934229](E:\Typora\Image\image-20200717142934229.png)

3. 查看扫描目标的版本是否与主机报表中获取的openssh版本一致（与客户的实际安装的openssh对比，是否一致，若不一致查看客户是否安装多个openssh；若一致向下排查）

4. 查看主机报表中漏洞详细描述，查看该漏洞影响范围——在受影响范围内则不是误报（若在受影响范围内，则非误报；若不在受影响范围，则为误报。PS：查看受影响范围有2种方式：一种是直接从主机报表漏洞详细描述看；另一种为点击漏洞的cve编号，然后查看影响范围）

    

    

- 版本扫描出现的误报，属于合理性误报，涉及到版本扫描的漏洞集中于远程扫描openSSH、openSSL、oracle等，由于漏洞等级较高，比如远程代码执行、远程拒绝服务、任意文件写入、信息泄露等等，如果利用原理扫描，会存在较为严重的风险，因此使用版本匹配扫描。客户可以选择通过登陆扫描来减少这类误报
- 登陆扫描可以尝试获取windows补丁、oracle补丁、SSH详细补丁版本号等等
- 原理扫描误报较小，可以先手工验证漏洞是否存在，然后再决定是否要收集调试和抓包



###### oracle数据库误报分析

- 首先启用oracle深度扫描

- 启用口令猜测或使用登陆检查：

    - 使用具有超级管理员权限的系统用户做启用口令猜测扫描

    - 登陆检查

        可以查看oracle_home变量或具有db权限的数据库用户

- 确认是否登陆成功：

    - 启用口令猜测验证成功登陆方法---是否扫出目标服务器的弱口令漏洞

- 登录检查验证成功登录方法

    - 在主机报表中对应的漏洞中是否可以查看到补丁信息

补丁安装确认方法：根据cve编号在oracle官网上查询对应的补丁

补丁已打，登陆成功，漏洞仍存在？主机报表，调试诊断信息，补丁截图

###### 服务识别误报分析

客户提供了主机报表，并且说明目标机上未开启某服务，但报表中显示了该服务，此类情况的误报分析步骤如下：

1. 查看扫描器的版本是否为最新版本
2. 在主机报表中查看该服务对应的端口
3. 在目标机上查看该端口对应的进程，和客户确认是否安装了该应用

###### Linux端口与进程查询

进程查看：ps aux

端口查询：netstat -antu

查询端口与进程的关系：lsof -i tcp:port

###### Windows端口与进程查询

共享：net share

组策略：gpedit.msc

建立连接：telnet

端口与进程

- 当前连接查询：netstat -ano
- 当前进程列表：tasklist /svc

以上两条命令均有进程PID给出，找出对应进程即可找出端口对应进程，如：netstat -ano | findstr "8081"，tasklist /svc | findstr "488"

###### Windows弱口令与空口令的漏报

弱口令：

- 字典中存在该账户与密码
- 账户为被禁用
- SMB协议开启，且防火墙放开TCP139，445端口
- 组策略中设置经典登录方式

空口令：

除上述条件外，还需在组策略中禁用“空白密码只允许控制台登录”

###### 开启SSH服务

通过ssh访问rsas的方法：

1. RSAS能访问公网，开启SSH服务后，使用“NSFOCUS专家诊断”映射后台，将通道A建立-HASH、通道B建立-HASH告知工程师
2. RSAS不能访问公网，使用portGo小工具，此时应保证那台安装portgo的pc机能够访问外网

注意，无论是使用专家诊断还是portgo，都要开启ssh服务

###### 打开调试模式

调试模式可以将整个扫描过程中插件的检测和输出信息以及引擎调用相关信息都记录下来，扫描速度慢，但是研发可以通过调试信息有效排查问题

只有开启“调试模式”的任务才有“导出调试信息”选项

###### 客户的服务使用的不是标准端口如何扫描

- 在端口列表中添加自定义端口，端口扫描策略选择“标准端口扫描”
    - “服务名”只是用来进行标记，与端口对应的服务没有关系

- 端口扫描策略选择“指定端口范围”

不允许扫描某端口--屏蔽端口

###### 扫描目标输入问题

- 直接输入IP或域名填入参数（我们最常用的输入方式）
- 从“浏览”导入，将扫描目标写入“TXT”文件，然后导入（适用于扫描目标过多，且不定期进行扫描）
- 从资产树导入（适用于使用了资产管理功能的客户）
- 从已有任务中选择

###### 任务执行的方式

- 立即执行：即时评估任务。需要立即进行网络安全评估时，可以下达即时评估任务
- 定时执行：定时评估任务。需要避开业务高峰期对网络进行安全评估时，可以下达定时评估任务
- 每天一次、每周一次、每月一次（按日期）或每月一次（按星期）：周期评估任务。需要定期
- （每天、每周或每月）对网络系统做安全评估时，可以下达周期评估任务
- 高级配置：配置【周期时间】，单机图标，选择多个时间段执行周期扫描任务

###### 如何选择漏洞模板

自动匹配扫描（最常用的）

根据客户需求选取特定的系统漏洞模板进行扫描

使用自定义模板进行某一个或某些漏洞进行扫描

漏洞模板选择“无模板”，不做漏洞扫描（常用于只做配置核查，不做漏洞扫描）

###### 如何备份配置信息/系统还原

![image-20200717151744154](E:\Typora\Image\image-20200717151744154.png)

###### 审计日志

审计日志需要登录auditor ，首次登陆auditor需要进行激活

激活auditor的方法：登录admin用户，在系统管理>用户>管理员列表下，激活auditor账户

###### 不能新增用户

不同型号的RSAS可新增用户数不同，可以到藏经阁中查看产品规格表，确定客户所能增加用户的最大数

![image-20200717160840821](E:\Typora\Image\image-20200717160840821.png)

###### 扫描器访问速度很慢

- 是否有扫描任务正在运行，如有好几个任务同时在运行访问速度慢是正常的。
- 是否设备中任务数很多(上百个，很多任务都是多个存
    活IP)，资产树中资产是否很多，如果很多的话，设备
    数据库会比较大，访问自然会慢
    可以删除任务后重启设备缓解，但要彻底解决速度慢的问题需要重装系统
- 除上述两种情况外，还有一种情况是端口协商不成功，可以建议换一个交换机或换一个接口试试

###### 任务异常结束

1. 任务扫描进行中自动升级;
2. 任务扫描过程中设备被强制关机;
3. 任务扫描过程中目标设备网络连接断(即一开始网络可达，但扫到中间的时候网络断了);
4. 并发任务数过高，可能导致任务异常终止;
5. 设备本身程序问题

###### 涉密版RSAS与通用版RSAS对比

涉密版RSAS采用三权分立模式管理设备

![image-20200717161305320](E:\Typora\Image\image-20200717161305320.png)

通用版RSAS

![image-20200717161417981](E:\Typora\Image\image-20200717161417981.png)

###### 目标主机宕机风险

常见于集群服务的设备和某些网络设备上，主要是由于目标设备存在拒绝服务的脆弱性导致

- 扫描HP-UNIX集群服务器，会造成服务器宕机
- 极光扫描Oracle 9i服务器时，造成服务器拒绝服务
- 扫描中兴EPON设备造成设备宕机
- 扫描IBMAIX集群服务器，会造成服务器宕机
- 扫描cisco 3750交换机，交换机cpu升高到100%，极端情况交换机重启

###### 其他问题

![image-20200717161641193](E:\Typora\Image\image-20200717161641193.png)

## RSAS VM

#### 产品虚拟化形态介绍

![image-20200717162247443](E:\Typora\Image\image-20200717162247443.png)

#### 加密狗（目前使用最多的）

![image-20200717162435353](E:\Typora\Image\image-20200717162435353.png)

#### 安装部署以及配置方法

虚拟镜像部署环境支持情况

![image-20200717162539544](E:\Typora\Image\image-20200717162539544.png)

虚拟机配置要求

![image-20200717162603833](E:\Typora\Image\image-20200717162603833.png)

虚拟设备配置过程

![image-20200717162747775](E:\Typora\Image\image-20200717162747775.png)

虚拟设备认证模式介绍

![image-20200717163008759](E:\Typora\Image\image-20200717163008759.png)

云端认证方式介绍

![image-20200717163519575](E:\Typora\Image\image-20200717163519575.png)

集中授权认证方式介绍

![image-20200717164309100](E:\Typora\Image\image-20200717164309100.png)

#### F04版本功能优化

##### 支持自定义web界面访问端口

系统管理-配置-系统配置-web端口设置

##### 自定义模板

可以自定义模板进行漏洞追加、也可以自定义模板中不想要的插件进行删除

##### 设备支持DHCP自动获取IP

![image-20200717164716099](E:\Typora\Image\image-20200717164716099.png)

##### 其他

支持最大任务并发系统插件数设置：针对单个主机

支持万兆网卡的识别

支持网口流量查看

支持报表输出的名称自定义

##### 产品稳定性优化

![image-20200717164830044](E:\Typora\Image\image-20200717164830044.png)

#### 系统优化时的注意事项

![image-20200717165008616](E:\Typora\Image\image-20200717165008616.png)

![image-20200717165026311](E:\Typora\Image\image-20200717165026311.png)

虚拟化镜像支持哪些授权方式：

- 加密狗
- 云端认证
- 集中授权

但并不是没有部署环境都全部支持这三种模式

![image-20200717165114498](E:\Typora\Image\image-20200717165114498.png)